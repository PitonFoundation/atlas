{% extends "base.html" %}

{% load i18n sekizai_tags menu_tags storybase_tags compress %}

{% block head_title %}{{ storybase_explore_title }}{{ block.super }}{% endblock %}

{% block extrameta %}
<meta name="title" content="{{ storybase_explore_title }}" />
<meta name="description" content="{% blocktrans %}Browse and filter {{ storybase_site_name }} stories by topic, location, language, organization and badges.{% endblocktrans %}">


<!-- Open Graph Protocol tags -->{% url "explore_stories" as explore_url %}
<meta property="og:url" content="{% fullurl explore_url %}" />
<meta property="og:title" content="{{ storybase_explore_title }}" />
<meta property="og:description" content="{% blocktrans %}Browse and filter {{ storybase_site_name }} stories by topic, location, language, organization and badges.{% endblocktrans %}" />
<meta property="og:image" content="{{ storybase_site_logo }}" />
{% endblock %}

{% block extrahead %}
{% comment %}
Handlebars templates for rendering Backbone views.
{% endcomment %}

{% verbatim %}
<script type="text/x-handlebars-template" id="story-count-template">
  <h6 class="story-count">{{count}} {{gettext "of"}} {{total}} {{#blockgettext}}Stor{{pluralize count suffix="y,ies"}} Shown{{/blockgettext}}</h6>
  {{#if showMore }}
  <a id="show-more" href="#">{{gettext "Show More"}}</a>
  {{/if}}
</script>

<script type="text/x-handlebars-template" id="filters-template">
<div class="fields-container">
    <div class="field">
        <label for="topics">{{gettext "Topic"}}</label>
        <select name="topics" data-placeholder="{{gettext "Topic"}}" title="{{gettext "Filter stories by selecting one or more topics"}}">
            <option></option>
            {{#topics}}
            <option value="{{id}}"{{#if selected}}selected{{/if}}>{{name}}</option>
            {{/topics}}
        </select>
    </div>

    <div class="field">
        <label for="places">{{gettext "Place"}}</label>
        <select name="places" data-placeholder="{{gettext "Place"}}" title="{{gettext "Filter stories by selecting one or more places"}}">
            <option></option>
            {{#places}}
            <option value="{{id}}"{{#if selected}}selected{{/if}}>{{name}}</option>
            {{/places}}
        </select>
    </div>

    <div class="field">
        <label for="organizations">{{gettext "Organization"}}</label>
        <select name="organizations" data-placeholder="{{gettext "Organization"}}" title="{{gettext "Filter stories by selecting an organization"}}">
            <option></option>
            {{#organizations}}
            <option value="{{id}}"{{#if selected}}selected{{/if}}>{{name}}</option>
            {{/organizations}}
        </select>
    </div>

    <div class="field">
        <label for="badges">{{gettext "Badge"}}</label>
        <select name="badges" data-placeholder="{{gettext "Badge"}}" title="{{gettext "Filter stories by selecting a badge"}}">
            <option></option>
            {{#badges}}
            <option value="{{id}}"{{#if selected}}selected{{/if}}>{{name}}</option>
            {{/badges}}
        </select>
    </div>

    <div class="field last">
        <label for="languages">{{gettext "Language"}}</label>
        <select name="languages" data-placeholder="{{gettext "Language"}}" title="{{gettext "Filter stories by language"}}">
            <option></option>
            {{#languages}}
            <option value="{{id}}"{{#if selected}}selected{{/if}}>{{name}}</option>
            {{/languages}}
        </select>
    </div>

    <a class="clear-filters" href="#">Reset Filters</a>
</div>
</script>

<script type="text/x-handlebars-template" id="story-link-partial-template">
<a href="{{url}}">{{title}}</a>
</script>

<script type="text/x-handlebars-template" id="story-partial-template">
<a href="{{url}}" class="image-container">
  <img src="{{featured_asset_url}}">
  <em class="hover"></em>
</a>
<div class="story-metadata">
  <h3>{{>story_link}}</h3>
  <p class="byline">{{byline}}</p>
  {{firstparagraph summary}}
  {{#if connected_count}}
  <p><a href="{{url}}#connected"><i class="icon-comments-alt icon-fixed-width"></i>{{connected_count}} {{#blockgettext}}connected stor{{pluralize connected_count suffix="y,ies"}}{{/blockgettext}}!</a></p>
  {{/if}}
  <dl class="story-attributes">
    <dt><p>{{gettext "Languages"}}</p></dt>
    <dd>
      <ul class="languages">
        {{#each languages}}
        <li><p>{{name}}</p></li>
        {{/each}}
      </ul>
    </dd>
  </dl>
</div>
</script>

<script type="text/x-handlebars-template" id="story-template">
<li id="{{story_id}}" class="story">
  {{> story}}
</li>
</script>

{% endverbatim %}
{% endblock %}

{% block body_class %}explorer{% endblock %}

{% block above_content %}
{% show_breadcrumb "breadcrumbs.html" %}
{% endblock %}

{% block base_content %}
{% addtoblock "css" %}<link rel="stylesheet" href="{{ STATIC_URL }}js/libs/select2/select2.css">{% endaddtoblock %}
{% addtoblock "css" %}<link rel="stylesheet" href="{{ STATIC_URL }}js/libs/tooltipster-2.1.4/css/tooltipster.css">{% endaddtoblock %}


<h1><span>{{ storybase_explore_title }}</span></h1>
<div id="explorer"></div>


{% addtoblock "js" %}
<script>
// Before loading all of our jQuery plugins, switch jQuery to our recent version
jQuery = jqLatest;
$ = jQuery;
</script>
<script src="{{ STATIC_URL }}js/libs/underscore-min.js"></script>
<script src="{{ STATIC_URL }}js/libs/json2.js"></script>
<script src="{{ STATIC_URL }}js/libs/backbone-min.js"></script>
<script src="{{ STATIC_URL }}js/libs/handlebars-1.0.0.beta.6.js"></script>
<script src="{{ STATIC_URL }}js/libs/jquery.masonry.min.js"></script>
<script src="{{ STATIC_URL }}js/libs/select2/select2.min.js"></script>
<script src="{{ STATIC_URL }}js/libs/spin.min.js"></script>
<script src="{{ STATIC_URL }}js/libs/tooltipster-2.1.4/js/jquery.tooltipster.min.js"></script>
{% compress js %}
<script src="{{ STATIC_URL }}js/storybase.js"></script>
<script src="{{ STATIC_URL }}js/models.js"></script>
<script src="{{ STATIC_URL }}js/utils.js"></script>
<script src="{{ STATIC_URL }}js/views.js"></script>
<script src="{{ STATIC_URL }}js/explorer/application.js"></script>
<script src="{{ STATIC_URL }}js/explorer/views.js"></script>
{% endcompress js %}
<script type="text/javascript">
$(document).ready(function() {
  var storyData = {{ stories_json }};
  var selectedFilters = {{ selected_filters }};
  var explorer = new storybase.explorer.views.ExplorerApp({
    storyData: storyData,
    selectedFilters: selectedFilters
  });
  explorer.render();
});
</script>
{% endaddtoblock %}
{% endblock %}

{% block extrajs %}
<script type="text/javascript" src="{% url "django.views.i18n.javascript_catalog" %}"></script>
{% endblock %}
