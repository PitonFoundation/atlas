{% extends "storybase_user/account_base.html" %}

{% load cms_tags sekizai_tags menu_tags i18n %}

{% block head_title %}{% trans "My Account" %}{% endblock %}

{% block body_title %}{%trans "My Stories" %}{% endblock %}

{% block twocol-content %}
{% if user.stories.count %}
<table class="account-stories">
    <thead>
        <tr>
            <th>{% trans "Title" %}</th>
            <th>{% trans "Last Edited" %}</th>
            <th>{% trans "Status" %}</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
    {% for story in user.stories.all %}
        <tr>
            <td><a class="view"  href="{{ story.get_absolute_url }}">{{ story }}</a></td>
            <td>{{ story.last_edited }}</td>
            <td>
              <span class="status">{{ story.status|capfirst }}</span>
              {% if story.status == 'published' %}
                <form action="{{ story.get_absolute_url }}unpublish/" method="post">
                  {% csrf_token %}
                  <input type="hidden" name="story_id" value="{{ story.story_id }}">
                  <button class="button gray publish" type="submit">{% trans "Unpublish" %}</button>
                </form>
              {% endif %}
              {% if story.status == 'draft' %}
                <form action="{{ story.get_absolute_url }}publish/" method="post">
                  {% csrf_token %}
                  <input type="hidden" name="story_id" value="{{ story.story_id }}">
                  <button class="button gray unpublish" type="submit">{% trans "Publish" %}</button>
                </form>
              {% endif %}
              {% if story.status != 'deleted' %}
                <form action="{{ story.get_absolute_url }}delete/" method="post">
                  {% csrf_token %}
                  <input type="hidden" name="story_id" value="{{ story.story_id }}">
                  <button class="button gray delete" type="submit">{% trans "Delete" %}</button>
                </form>
              {% endif %}
            </td>
            <td><a class="build" href="{{ story.builder_url }}">{% trans "Build" %}</a></td>
    </tbody>
    {% endfor %}
</table>
{% else %}
<p>{% trans "You have no stories" %}</p>
{% endif %}
{% endblock %}
